[English Version](../Readme.md)

# 關於這個作品

這是一個網頁版的記帳軟體，使用者可以增加、刪除和編輯每日的支出和收入資料。這個軟體提供很多不同的功能來處理使用者輸入的資料，藉此幫助使用者用更有條理和效率的方式來管理使用者的財富。

&nbsp;

# 作品的動機

在製作這個作品之前，我就一直想要用我剛學的技術去完成一個作品。但我不單單只是想要做出一個作品那麼簡單，我更想要去解決一個現實生活中的問題。在過去的幾年裡，我一直都有記帳的習慣，不過只限於用手機的應用軟體。這在一開始似乎很好而且很方便，但我在之後開始遇到一些問題。當我儲存的資料越來越多，以及我想要更複雜的功能時，手機版的記帳軟體就變得越來越難用。除此之外，使用方便的代價就是螢幕大小的限制，更大的螢幕可以有更好的使用者體驗。基於以上問題，雖然擁有手機版的軟體很好，但如果有一個電腦版的記帳軟體會更好，因此給予了我動機，去完成一個有許多功能且可以幫助我解決日常困難的記帳軟體。

&nbsp;

# 使用的技術

- HTML
- CSS
- Javascript
- React.js
- Chart.js
- Firebase
- API - MarketAux

&nbsp;

# 作品概述

_如果您偏好看影片大於閱讀的話，我建議可以省略此部分，並直接去看影片。_

作品中總共有六個頁面，而在這邊會簡單概要的介紹每個頁面。作品大致上的排版可以分成兩個部分，在左手邊是側邊欄位，使用者可以點擊不同的圖案來切換不同的主頁，而在右手邊是對應的畫面。

## Home page

主頁的頁面可以簡單地分成兩個部分

主要部分（左手邊）

&#8594; 記錄著每日的交易資料，使用者可以藉由點選週曆的列表來切換到不同的日期

&#8594; 能藉由左右兩側的箭頭按鈕來切換到不同的週期

次要部分（右手邊）

&#8594; 上方的區塊顯示了這一整個星期的總支出、總收入以及總淨收入

&#8594; 下方的區塊顯示了兩個簡單的圖表去幫助使用者能夠用視覺化的方式來瞭解一週的支出變化

&nbsp;

## Calendar page

月曆的頁面可以簡單地分成兩個部分

主要部分（左手邊）

&#8594; 記錄一個月內的所有交易資料，粉紅色的小點代表著收入資料，藍色的小點代表著支出資料

&#8594; 點選其中一個日期來顯示那天所有的詳細資料

&#8594; 藉由左右兩側的箭頭按鈕來切換到不同的月份

次要部分（右手邊）

&#8594; 上方的區塊顯示了這一整個月份的總支出、總收入以及總淨收入

&#8594; 下方的區塊顯示了兩個簡單的圖表去幫助使用者能夠用視覺化的方式來瞭解一個月份的支出變化

&nbsp;

## Chart page

圖表的頁面可以簡單地分成兩個部分

主要部分（右手邊）

&#8594; 顯示了長條圖或是圓餅圖

次要部分（右手邊）

&#8594; 多樣化的選項來讓使用者可以客製化圖表

&nbsp;

## Search page

搜尋的頁面可以簡單地分成兩個部分

主要部分（右手邊）

&#8594; 顯示了所有的支出和收入資料

&#8594; 藉由不同的按鈕來排序資料，也可以輸入備註來搜尋特定的資料

次要部分（右手邊）

&#8594; 點擊多選匡來篩選資料

&nbsp;

## Account page

帳戶的頁面可以簡單地分成兩個部分

主要部分（左手邊）

&#8594; 三個小區塊顯示了整個帳戶的總支出、收入和淨收入

&#8594; 下方圖表顯示了不同時間維度的累積淨收入

次要部分（右手邊）

&#8594; 上方區塊顯示了近期的財經新聞

&#8594; 下方區塊顯示三個簡單的圖表去幫助使用者了解到個人的消費習慣

&nbsp;

## Setting page

帳戶的頁面有三個小的次頁面

帳戶
&#8594; 顯示個人資料，像是名字和信箱

外觀
&#8594; 切換成深色模式或淺色模式
&#8594; 此作品是以深色模式作為預設

類別
&#8594; 不僅顯示了所有的主類別和次類別，也能讓使用者增加和刪除類別

&nbsp;

# 探討細節

_如果您偏好看影片大於閱讀的話，我建議可以省略此部分，並直接去看影片。_

在這邊會說明此作品中的三個細節

## 1. 格式化價錢的表示

為了提供一個清楚貨幣的表示，每當超過三位數時，會使用”,”來區分。例如，不要單純的顯示$2930，而是更清楚的顯示$2,930。此外，當有一個極度高的價格時，如果完整的顯示此價格會變得很冗長，因此我用英文字母來表示高價錢。例如，1,000,000 = 1M (百萬), 1,000,000,000 = 1B(十億), 1,000,000,000,000 = 1T(兆)，所以如果顯示 23B，而不是顯示完整的 23,000,000,000，會更加的清楚。這個細節讓使用者可以輕易的辨認正確的價錢，同時也能維持使用者介面的格局。

## 2. 當在製作圓餅圖時，防止使用者輸入錯誤的資料

當要製作圓餅圖時，使用者必須輸入起始日和終止日，但是終止日早於起始日是不太合理的事。例如，如果使用者選擇 2021-09-12 當作起始日時，必須確保使用者只能選擇起始日之後的日期當作終止日，也就是 2021-09-13 之後。這個細節能夠幫助使用者輸入正確的資料，因為輸入錯誤的資料很有可能會導致錯誤的產生。

## 3. 防止使用者輸入重複的類別名稱

在此作品中，使用者可以新增類別，但有兩個重複名稱的類別是不太合裡的事情。為了避免發生，當使用者嘗試輸入重複的類別名稱時，按鈕會喪失功能，同時會顯示警告的字樣來告知使用者。

# 特殊的小技巧

在此我想要說明兩個在作品中使用的小技巧

## 1. throttle 函數和 useCurWidth 客製的 hook

當我嘗試在讓這個作品的排版可以符合每種大小的裝置時，我遇到一個問題，也就是當使用者開始改變視窗大小時，我想要知道視窗的大小。我的第一個直覺就是單純的在 window 上加 event listener，同時用 useState 去抓住每個視窗的大小。這個方法是可行的，然而，這樣會造成程式非常的沒有效率，因為當使用者持續不斷地改變視窗大小時，會需要不斷的重新渲染整個元件函數（component function）。最壞的情況是整個元件函數可能會需要在短短的幾秒鐘裡重新渲染一千次。為了解決這個問題，我需要一個函數來幫助我確保只會在特定的時間內觸發函數。於是，我開始在上網尋找解答，然後發現有一個函數正好可以解決這個問題，那就是 throttle 函數。

```
function throttle(func, delay) {
  let wait = false;
  let latestArg = null;

  function timeoutFunc() {
    if (!latestArg) {
      wait = false;
    } else {
      func.call(this, ...latestArg);
      latestArg = null;
      setTimeout(timeoutFunc, delay);
    }
  }

  return function (...args) {
    if (wait) {
      latestArg = args;
      return;
    }

    func.call(this, ...args);
    wait = true;

    setTimeout(timeoutFunc, delay);
  };
}

export default throttle;
```

雖然這個函數並不是我自己寫的，但我有確實讀過程式碼，並嘗試了解此函數背後的機制。在讀過後發現這個函數包含了很多重要的觀念，像是 high order function, spread operator, rest operator, recursion, asynchronous, and closure。因為不同的元件函數都會需要視窗的大小，因此我建立一個客製化的 hook 來處理所有的運算和邏輯，只要確保這個客製化的 hook 最終能回傳正確的視窗大小即可。

```
import { useState, useEffect } from "react";
import throttle from "../Throttle/throttle";

function useCurWidth() {
  const [curWidth, setCurWidth] = useState(window.innerWidth);

  useEffect(() => {
    const detectWindowWidth = throttle(function handleResize() {
      setCurWidth(window.innerWidth);
    }, 300);

    window.addEventListener("resize", detectWindowWidth);

    return () => window.removeEventListener("resize", detectWindowWidth);
  }, []);

  return curWidth;
}

export default useCurWidth;
```

這個客製化的 hook 叫做 useCurWidth，它不需要任何的參數，但始終回傳正確的視窗大小。我使用 useEffect hook 因為在 window 上加 event listener 會造成 side effect。此外，由於 throttle 函數，當視窗大小不斷的改變時，handleResize 函數只會在 300 毫秒後被觸發。

## 2. mutipleArgsHelper 函數

因為這是一個記帳軟體的作品，所以會有很多地方會需要處理到字串的運算。例如，我想要格式化價錢的表示，然而，同時有支出、收入和淨收入需要同時被格式化，而這是我一開始所寫的程式碼。

```
const income = formatMoney(props.income);
const expense = formatMoney(props.expense);
const netIncome = formatMoney(props.netIncome);
```

這個沒問題，但是程式碼有點冗長。更重要的事，這是用聲明式(imperative)的方式在寫程式，我們告示電腦**_如何_**做一步一步的做運算。由於我是用 React 來做這個作品，這會是一個好的時機點用命令式(declarative)的方式來寫程式碼，而這個方式正式 functional programming 的重要觀念之一。不像是告訴電腦**_如何_**做，而是告訴電腦我們想要**_什麼_**樣的結果，所以我寫了這個 mutipleArgsHelper 函數。

```
function mutipleArgsHelper(fn, ...args) {
  return args.map(fn);
}

export default mutipleArgsHelper;
```

這個函數相當簡單。第一個參數叫做 fn，而後面的參數叫做 args。用 ...args 的原因是因為我不知道有多少的參數會被丟入這個函數，而且不提前去預設參數的數量可以讓這個函數變得可重複使用。所以我用 rest operator，讓之後所有的參數變成一個 array，然後用 map 函數對每個參數做 fn 函數的運算。由於 fn 是一個只接受一個參數的一元（unary）函數，所以我可以用 _point-free_ 的方式來寫程式碼。

接著我應用這個函數在我需要讓程式碼更簡潔的地方

```
const [income, expense, netIncome] = mutipleArgsHelper(
    formatMoney,
    props.income,
    props.expense,
    props.netIncome
  )
```

&nbsp;

# 反思

## 在做這個作品時有遇到什麼主要的困難嗎？

在做作品時，有兩個主要的困難。

1.  資料的類型

    第當程式碼的規模越來越大時，會越來越難知道一個變數到底存著什麼類型的值(value)。例如，我有一個 helper 函數在一個檔案，然後我用這個 helper 函數在另一個元件函數，接著把這個函數所產出的值再傳入不同的 child component。很快的，會變得很難輕易地瞭解一個變數到底存著什麼類型的值。因為 Javascript 是一個 untyped 或 dynamically typed 的語言，當要宣告一個變數時，Javascript 的開發者不需要事先告知變數是存著什麼類型的值。這似乎對初學者來說能夠更容易的上手這語言，但是當我這做這個作品時，這樣的方便逐漸變成痛苦。為了要提醒我自己一個變數存著什麼類型的值，我必須在變數的名稱後面加上 "str”, “num”, “arr”, or “obj”，所以我才不會忘記變數存著什麼類型的值。但這樣做會讓程式碼變得很雜亂，以及造成更多淺在的錯誤。

2.  檢查程式碼（code review）

    在完成這個作品後，我嘗試著自己檢查程式碼，因為當初一開始在寫程式碼時，並沒有把程式碼寫得非常乾淨以及沒有用一個完整的組織性架構去寫程式碼。當我說檢查程式碼時，我並不是指專業的檢查程式碼，我只是單純的指要讓程式碼更乾淨以及更有架構。由於當我一開始寫程式碼時就沒有注重維護性(maintenance)，所以檢查程式碼的過程非常痛苦。因此，當寫完作品後才開始注重維護性已經為時已晚，即使我竭盡所能的去做程式碼檢查，我仍然無法讓每行程式碼都非常乾淨。這個經驗教會了我在開發一個應用軟體前，思考維護性是一件非常重要的事。

3.  維護性

&nbsp;

## 在這份作品中我從中學到了什麼？

在這份作品中我學到一件事。作為一位前端的開發者，我必須要事前去思考所有可能造成錯誤或是預期之外的情境。例如，我在做這份作品時，我試著問自己

1. 問題：randomly select 按鈕會從伺服器請求資料，玩家有可能會不斷地按這個按鈕嗎？

   答：會。為了防止重複的從伺服器請求資料，可以用緩存（cache）的技巧來確保只有請求資料一次。

2. 問題：玩家有可能會猜一個無效的數字嗎？

   答：會。為了避免發生，當猜的數字是無效時，我必須要禁用或是隱藏按鈕

3. 問題：玩家有可能在其他玩家的回合時使用道具嗎？

   答：會。必須要告訴玩家他們不能在其他玩家的回合時使用道具

為了要開發一個好的網頁應用軟體，我不能總是假設使用者只會正常地使用軟體，所以要先想到所有可能發生的情況，並且提早去預防或修改。

&nbsp;

## 這份作品中也哪些地方是可以改善的？

在這份作品中有三件事情是可以被加進去或是改善的。

1. 即時互動的功能

   如果可加入即時互動的功能，就能讓這份作品更像一個線上遊戲。這個想法很好，但因為我才剛學玩前端方面的知識，要我實際寫出程式碼來執行是非常困難的。

2. 後端的系統

   這份作品也能加後端的系統來儲存玩家的各種資料。然而，我目前想要更扎實地學好且應用前端的知識，因此如果未來有學到後端語言的知識，我會想辦法加進這個作品之中

3. 程式碼架構

   這份作品的程式碼架構不是很好，我幾乎是把所有 JavaScript 的程式碼都放在ㄧ個檔案裡。即使目前來說是可以接受的，但當程式碼的規模越來越大時，做好程式碼的架構區分是非常重要的。因此，在下一放作品中，我會想辦法把程式碼放在不同的檔案，讓整個架構可以更乾淨許多。
